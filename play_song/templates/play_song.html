<!DOCTYPE html>
<html lang="en">



<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Song Details</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f8f8;
            color: #333;
            margin: 0;
            padding: 20px;
        }

        /* ================= HEADER ================= */
        .song-header {
            background-color: #C48B5F;
            /* Maroon color */
            color: #ffffff;
            /* White color for text */
            text-align: center;
            padding: 20px;
            position: relative;
        }

        .page-title {
            font-weight: 600;
            font-size: 24px;
            color: #FFFFFF;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        /* ================= SONG ================= */
        .song-info {
            display: flex;
            /* Use flexbox to align items side by side */
            align-items: center;
            /* Aligns items vertically in the center */
            justify-content: start;
            /* Aligns content to the start of the flex container */
            padding: 20px;
        }

        .song-title {
            font-weight: 600;
            font-size: 36px;
            margin: 0;
        }

        /* Song detail section */
        .song-details {
            margin-bottom: 20px;
        }

        /* ================= Play progress bar ================= */
        .play-progress {
            width: 100%;
            height: 10px;
            background-color: #ffffff;
            margin-bottom: 20px;
        }

        /* Style for the progress bar */
        progress {
            width: 100%;
            height: 100%;
            appearance: none;
            -webkit-appearance: none;
            border: none;
            background-color: #f8f8f8;
            /* Light gray background */
            border-radius: 10px;
        }

        /* Style for the progress bar value */
        progress::-webkit-progress-value {
            background-color: #C48B5F;
            /* Maroon background */
            border-radius: 10px;
        }

        progress::-moz-progress-bar {
            background-color: #C48B5F;
            /* Maroon background */
            border-radius: 10px;
        }

        /* ================= Buttons ================= */
        .play-button,
        .add-to-playlist-button,
        .download-button,
        .back-button {
            font-weight: 600;
            padding: 10px 20px;
            margin-bottom: 10px;
            cursor: pointer;
            border: none;
            border-radius: 20px;
            display: inline-block;
        }

        .play-button,
        .add-to-playlist-button,
        .download-button {
            background-color: #C48B5F;
            /* Maroon background */
            color: #FFFFFF;
            /* White text */
        }

        .play-button:hover,
        .add-to-playlist-button:hover,
        .download-button:hover {
            background-color: #A5694F;
        }

        .back-button {
            background-color: transparent;
            color: #C48B5F;
            /* Maroon color */
            border: 2px solid #C48B5F;
        }

        .back-button:hover {
            color: #A5694F;
            border-color: #A5694F;
        }

        /* Add to playlist form */
        .add-to-playlist-form {
            display: none;
        }

        /* Success message */
        .success-message {
            display: none;
        }

        /* Dropdown styling */
        #playlist-dropdown {
            padding: 8px;
            margin-bottom: 10px;
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        /* Form buttons */
        #playlist-form button {
            font-weight: 600;
            padding: 10px 20px;
            margin-bottom: 10px;
            cursor: pointer;
            border: none;
            border-radius: 20px;
            display: inline-block;
            background-color: #C48B5F;
            /* Maroon background */
            color: #FFFFFF;
            /* White text */
        }

        #playlist-form button:hover {
            background-color: #A5694F;
        }
    </style>
</head>

<body>

    <!-- Your existing HTML structure -->
    <!-- SONG DETAIL section -->
    <div class="song-header">
        <p class="page-title">Play Song</p>
    </div>
    {% if song %}
    <div class="song-info">
        <div class="song-logo"></div>
        <div class="song-text">
            <p class="song-title">{{ song.judul }}</p>
            <p class="song-genre">Genre(s):<br>
                {% for genre in genres %}
                - {{ genre }}<br>
                {% endfor %}
            </p>
            <p class="song-singer">Artist: {{ song.penyanyi }}</p>
            <p class="song-songwriter">Songwriter(s):<br>
                {% for songwriter in songwriters %}
                - {{ songwriter }}<br>
                {% endfor %}
            </p>
        </div>
    </div>
    <div class="song-details">
        <p>Durasi: {{ song.durasi }} menit</p>
        <p>Tanggal Rilis: {{ song.tanggal_rilis }}</p>
        <p>Tahun: {{ song.tahun }}</p>
        <p>TotalPlay: {{ song.total_play }}</p>
        <p>TotalDownloads: {{ song.total_download }}</p>
        {% for album in albums %}
        <p>Album: {{ album }}</p>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Play progress bar -->
    <div class="play-progress">
        <progress id="play-progress-bar" value="0" max="100"></progress>
    </div>

    <!-- Buttons -->
    <button class="play-button">Play</button>
    <button class="add-to-playlist-button">Add to Playlist</button>
    <button class="download-button">Download</button>
    <button class="back-button" onclick="history.back()">Kembali</button>

    <!-- ================= ADD SONG TO USER PLAYLIST section ================= -->
    <div class="add-to-playlist-form" style="display: none;">
        <h2>ADD SONG TO USER PLAYLIST</h2>
        <form id="playlist-form">
            <p>Judul: Song1</p>
            <p>Artist: Artist1</p>
            <label for="playlist-dropdown">Playlist:</label>
            <select id="playlist-dropdown" required>
                <!-- User's playlists options will be populated here -->
            </select>
            <button type="submit">TAMBAH</button>
            <button type="button" class="cancel-add-to-playlist">KEMBALI</button>
        </form>
    </div>

    <!-- Success message after adding song to playlist -->
    <div class="success-message" style="display: none;">
        <p>Berhasil menambahkan Lagu dengan judul 'Song1' ke 'Playlist1'!</p>
        <button class="go-to-playlist">KE PLAYLIST</button>
        <button class="back-to-song-details">KEMBALI</button>
    </div>

    <!-- ================= DONWLOAD ================= -->
    <!-- Success message after downloading song -->
    <div class="success-download-message" style="display: none;">
        <p>Berhasil mengunduh Lagu dengan judul ‘Song1’!</p>
        <button class="go-to-download-list">KE DAFTAR DOWNLOAD</button>
        <button class="back-to-song-details">KEMBALI</button>
    </div>





    <!-- Script -->
    <script>
        // ================= PLAY BUTTON =================
        const playButton = document.querySelector('.play-button');

        const progressBar = document.getElementById('play-progress-bar');

        let playProgress = 0;

        function updatePlayProgress() {
            if (progressBar.value >= 100) {
                // Reset the play progress value to 0 if it reaches 100%
                progressBar.value = 0;
            } else {
                progressBar.value += 10;
            }
        }

        function handlePlayButtonClick() {
            playProgress = progressBar.value;

            updatePlayProgress();

            if (playProgress > 70) {
                console.log('Play progress is greater than 70%. Perform action here.');

                const totalPlayCountElement = document.querySelector('.song-details td:first-child');
                // let totalPlayCount = parseInt(totalPlayCountElement.textContent);
                // totalPlayCount++;
                // totalPlayCountElement.textContent = totalPlayCount;
            } else {
                console.log('Play progress is not greater than 70%.');
            }
        }

        playButton.addEventListener('click', handlePlayButtonClick);

        // ================= ADD TO PLAYLIST BUTTON =================
        const addToPlaylistButton = document.querySelector('.add-to-playlist-button');

        const addToPlaylistForm = document.querySelector('.add-to-playlist-form');

        function handleAddToPlaylistButtonClick() {
            addToPlaylistForm.style.display = 'block';
            // hide DOWNLOAD FORM
            successDownloadMessage.style.display = 'none';
        }

        addToPlaylistButton.addEventListener('click', handleAddToPlaylistButtonClick);

        function handlePlaylistFormSubmission(event) {
            event.preventDefault();

            const selectedPlaylist = document.getElementById('playlist-dropdown').value;

            // Check if a playlist is selected
            if (selectedPlaylist !== '') {
                // Hide the form
                addToPlaylistForm.style.display = 'none';

                const successMessage = document.querySelector('.success-add-to-playlist-message');
                successMessage.textContent = `Berhasil menambahkan Lagu dengan judul ‘Song1’ ke ‘${selectedPlaylist}’!`;
                successMessage.style.display = 'block';

                // TODO: Add to playlist logic

            } else {
                alert('Playlist harus dipilih!');
            }
        }

        addToPlaylistForm.addEventListener('submit', handlePlaylistFormSubmission);

        function handleBackToSongDetailButtonClick() {
            addToPlaylistForm.style.display = 'none';

            const successMessage = document.querySelector('.success-add-to-playlist-message');
            successMessage.style.display = 'none';
        }

        const backToSongDetailButtonInForm = document.querySelector('.back-to-song-details');

        backToSongDetailButtonInForm.addEventListener('click', handleBackToSongDetailButtonClick);


        // ================= DOWNLOAD BUTTON =================
        const downloadButton = document.querySelector('.download-button');

        const successDownloadMessage = document.querySelector('.success-download-message');

        function handleDownloadButtonClick() {
            successDownloadMessage.style.display = 'block';
            // hide the plalist form
            addToPlaylistForm.style.display = 'none';

            const totalDownloadsCountElement = document.querySelector('.song-details td:nth-child(2)');
            // let totalDownloadsCount = parseInt(totalDownloadsCountElement.textContent);
            // totalDownloadsCount++;
            // totalDownloadsCountElement.textContent = totalDownloadsCount;
        }

        downloadButton.addEventListener('click', handleDownloadButtonClick);

        function handleGoToDownloadListButtonClick() {
            window.location.href = '/play_song/download/list';
        }

        const goToDownloadListButton = document.querySelector('.go-to-download-list');

        goToDownloadListButton.addEventListener('click', handleGoToDownloadListButtonClick);

        function handleBackToSongDetailButtonClick() {
            successDownloadMessage.style.display = 'none';
        }

        const backToSongDetailButton = document.querySelector('.back-to-song-details');

        backToSongDetailButton.addEventListener('click', handleBackToSongDetailButtonClick);

    </script>

</body>

</html>